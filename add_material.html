<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Material</title>

    <link rel="stylesheet" href="style.css">

    <!-- iOS home screen -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/icon-180.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <!-- Android PWA -->
    <link rel="manifest" href="manifest.webmanifest">
</head>

<body>

<header class="card header-bar">
    <button class="back-btn" onclick="window.history.back()">‚Üê Back</button>
    <h1 class="title">Add Material</h1>
    <img src="assets/icons/icon-192.png" class="header-icon">
</header>

<main>

    <section class="card">

        <label>Part Number</label>
        <input id="partNumber" class="input" />

        <label>Description</label>
        <textarea id="description" class="input" rows="3"></textarea>

        <label>Quantity</label>
        <input type="number" id="qty" class="input" />

        <label>Heat Number</label>
        <input id="heat" class="input" />

        <button class="primary-btn" onclick="saveMaterial()">Save Material</button>

    </section>

</main>

<script src="https://cdn.jsdelivr.net/npm/dexie@3.2.3/dist/dexie.min.js"></script>
<script src="db.js"></script>

<script>
// URL params
const params = new URLSearchParams(window.location.search);
const jobNumber = params.get("job");

// Save material
async function saveMaterial() {
    const part = document.getElementById("partNumber").value.trim();
    const desc = document.getElementById("description").value.trim();
    const qty = document.getElementById("qty").value.trim();
    const heat = document.getElementById("heat").value.trim();

    if (!part || !qty) {
        alert("Part number and quantity are required.");
        return;
    }

    await db.materials.add({
        jobNumber: jobNumber,
        partNumber: part,
        description: desc,
        qty: qty,
        heat: heat
    });

    window.location.href = "job.html?job=" + encodeURIComponent(jobNumber);
}
</script>

</body>
</html>
