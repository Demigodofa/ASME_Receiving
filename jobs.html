<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>Jobs</title>
    <link rel='stylesheet' href='style.css' />
</head>

<body>

<header class='card header-bar'>
    <button class='back-btn' onclick='window.history.back()'>
        ‚Üê Back
    </button>
    <h1 class='title'>Jobs</h1>
</header>

<main>

    <section class='card'>
        <h2>Job List</h2>
        <p>Select a job to view details.</p>

        <table class='table'>
            <thead>
                <tr>
                    <th>Job #</th>
                    <th>Description</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id='jobsTable'></tbody>
        </table>

    </section>

</main>

<script src="https://cdn.jsdelivr.net/npm/dexie@3.2.3/dist/dexie.min.js"></script>
<script src='db.js'></script>

<script>
// Load all jobs from IndexedDB
async function loadJobs() {
    const jobs = await db.jobs.toArray();
    const table = document.getElementById("jobsTable");

    table.innerHTML = "";

    if (!jobs.length) {
        table.innerHTML = "<tr><td colspan='3' style='text-align:center; padding:12px;'>No jobs saved.</td></tr>";
        return;
    }

    jobs.forEach(job => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${job.jobNumber}</td>
            <td>${job.description || ""}</td>
            <td>
                <button class='link-btn' onclick="openJob('${job.jobNumber}')">Open</button>
            </td>
        `;

        table.appendChild(tr);
    });
}

function openJob(jobNum) {
    window.location.href = "job.html?job=" + encodeURIComponent(jobNum);
}

loadJobs();
</script>

</body>
</html>
