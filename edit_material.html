<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Material</title>

    <link rel="stylesheet" href="style.css">

    <!-- iOS home screen -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/icon-180.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <!-- Android PWA -->
    <link rel="manifest" href="manifest.webmanifest">
</head>

<body>

<header class="card header-bar">
    <button class="back-btn" onclick="window.history.back()">‚Üê Back</button>
    <h1 class="title">Edit Material</h1>
    <img src="assets/icons/icon-192.png" class="header-icon">
</header>

<main>

    <section class="card">

        <label>Part Number</label>
        <input id="partNumber" class="input" />

        <label>Description</label>
        <textarea id="description" class="input" rows="3"></textarea>

        <label>Quantity</label>
        <input type="number" id="qty" class="input" />

        <label>Heat Number</label>
        <input id="heat" class="input" />

        <button class="primary-btn" onclick="saveMaterial()">Save Changes</button>
        <button class="secondary-btn" onclick="deleteMaterial()" style="margin-top:10px;">Delete Material</button>

    </section>

</main>

<script src="https://cdn.jsdelivr.net/npm/dexie@3.2.3/dist/dexie.min.js"></script>
<script src="db.js"></script>

<script>
// URL params
const params = new URLSearchParams(window.location.search);
const jobNumber = params.get("job");
const matId = Number(params.get("id"));

// Load material
async function loadMaterial() {
    const mat = await db.materials.get(matId);

    document.getElementById("partNumber").value = mat.partNumber || "";
    document.getElementById("description").value = mat.description || "";
    document.getElementById("qty").value = mat.qty || "";
    document.getElementById("heat").value = mat.heat || "";
}

// Save edits
async function saveMaterial() {
    const part = document.getElementById("partNumber").value.trim();
    const desc = document.getElementById("description").value.trim();
    const qty = document.getElementById("qty").value.trim();
    const heat = document.getElementById("heat").value.trim();

    if (!part || !qty) {
        alert("Part number and quantity are required.");
        return;
    }

    await db.materials.put({
        id: matId,
        jobNumber: jobNumber,
        partNumber: part,
        description: desc,
        qty: qty,
        heat: heat
    });

    window.location.href = "job.html?job=" + encodeURIComponent(jobNumber);
}

// Delete material
async function deleteMaterial() {
    if (!confirm("Delete this material?")) return;

    await db.materials.delete(matId);
    window.location.href = "job.html?job=" + encodeURIComponent(jobNumber);
}

loadMaterial();
</script>

</body>
</html>
